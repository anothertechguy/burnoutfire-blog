---
import BaseLayout from '../../components/Layout/BaseLayout.astro';
import { SITE_CONFIG } from '../../config';

const seo = {
  title: `Agent Workflow | ${SITE_CONFIG.title} Admin`,
  description: 'Run agents and create content',
};
---

<BaseLayout title="Agent Workflow" description="Agent workflow interface" seo={seo}>
  <div class="min-h-screen bg-gray-50 py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="mb-8">
        <a href="/admin" class="text-blue-600 hover:text-blue-800 mb-4 inline-block">← Back to Dashboard</a>
        <h1 class="text-3xl font-bold text-gray-900">Agent Workflow</h1>
        <p class="text-gray-600 mt-2">Run agents, answer questions, and create content</p>
      </div>

      <!-- Create New Content -->
      <div class="bg-white rounded-lg shadow p-6 mb-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Create New Content</h2>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Topic/Keyword</label>
            <input 
              type="text"
              id="content-topic"
              class="w-full border border-gray-300 rounded-md p-3"
              placeholder="e.g., 'coastfire vs burnoutfire'"
            />
          </div>
          <button 
            onclick="startContentCreation()"
            class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
          >
            Start Content Creation
          </button>
        </div>
      </div>

      <!-- Agent Questions -->
      <div class="bg-white rounded-lg shadow p-6 mb-6" id="agent-questions" style="display: none;">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Agent Questions</h2>
        <p class="text-sm text-gray-600 mb-4">The agent needs your input to create better content:</p>
        <div id="questions-list" class="space-y-4">
          <!-- Questions will be added here -->
        </div>
        <button 
          onclick="submitAnswers()"
          class="mt-4 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors"
        >
          Submit Answers & Continue
        </button>
      </div>

      <!-- Workflow Progress -->
      <div class="bg-white rounded-lg shadow p-6 mb-6">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Workflow Progress</h2>
        <div class="space-y-4" id="workflow-steps">
          <div class="flex items-center space-x-4">
            <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-600">1</div>
            <div class="flex-1">
              <h3 class="font-medium text-gray-900">Research Phase</h3>
              <p class="text-sm text-gray-600">Analyzing competitors and SERP</p>
            </div>
            <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded">Pending</span>
          </div>
          <div class="flex items-center space-x-4">
            <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-600">2</div>
            <div class="flex-1">
              <h3 class="font-medium text-gray-900">Strategy Phase</h3>
              <p class="text-sm text-gray-600">Creating content brief</p>
            </div>
            <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded">Pending</span>
          </div>
          <div class="flex items-center space-x-4">
            <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-600">3</div>
            <div class="flex-1">
              <h3 class="font-medium text-gray-900">Creation Phase</h3>
              <p class="text-sm text-gray-600">Writing content</p>
            </div>
            <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded">Pending</span>
          </div>
          <div class="flex items-center space-x-4">
            <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-600">4</div>
            <div class="flex-1">
              <h3 class="font-medium text-gray-900">Quality Phase</h3>
              <p class="text-sm text-gray-600">Validating quality</p>
            </div>
            <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded">Pending</span>
          </div>
        </div>
      </div>

      <!-- Generated Content Preview -->
      <div class="bg-white rounded-lg shadow p-6" id="content-preview" style="display: none;">
        <h2 class="text-xl font-semibold text-gray-900 mb-4">Generated Content</h2>
        <div class="border border-gray-300 rounded-md p-4 bg-gray-50 max-h-96 overflow-y-auto">
          <div id="preview-content" class="prose max-w-none">
            <!-- Content will be shown here -->
          </div>
        </div>
        <div class="mt-4 flex space-x-4">
          <button 
            onclick="approveContent()"
            class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors"
          >
            Approve & Save
          </button>
          <button 
            onclick="requestRevision()"
            class="px-4 py-2 bg-yellow-600 text-white rounded-md hover:bg-yellow-700 transition-colors"
          >
            Request Revision
          </button>
          <button 
            onclick="editManually()"
            class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
          >
            Edit Manually
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    async function startContentCreation() {
      const topic = document.getElementById('content-topic').value;
      if (!topic) {
        alert('Please enter a topic');
        return;
      }

      // Update workflow steps
      updateStep(1, 'active');
      
      // Simulate agent workflow
      setTimeout(() => {
        updateStep(1, 'complete');
        updateStep(2, 'active');
        showAgentQuestions([
          {
            question: 'What unique angle should we take on this topic?',
            type: 'textarea',
            required: true
          },
          {
            question: 'Do you have any personal experiences to include?',
            type: 'textarea',
            required: false
          },
          {
            question: 'What specific questions should we answer?',
            type: 'textarea',
            required: false
          }
        ]);
      }, 2000);
    }

    function showAgentQuestions(questions) {
      const container = document.getElementById('questions-list');
      container.innerHTML = '';
      
      questions.forEach((q, i) => {
        const div = document.createElement('div');
        div.className = 'border border-gray-300 rounded-md p-4';
        div.innerHTML = `
          <label class="block text-sm font-medium text-gray-700 mb-2">
            ${q.question} ${q.required ? '<span class="text-red-500">*</span>' : ''}
          </label>
          <textarea 
            id="question-${i}"
            rows="3"
            class="w-full border border-gray-300 rounded-md p-2"
            ${q.required ? 'required' : ''}
          ></textarea>
        `;
        container.appendChild(div);
      });

      document.getElementById('agent-questions').style.display = 'block';
    }

    async function submitAnswers() {
      const answers = [];
      const questions = document.querySelectorAll('#questions-list textarea');
      questions.forEach(q => answers.push(q.value));

      document.getElementById('agent-questions').style.display = 'none';
      updateStep(2, 'complete');
      updateStep(3, 'active');

      // Simulate content generation
      setTimeout(() => {
        updateStep(3, 'complete');
        updateStep(4, 'active');
        
        setTimeout(() => {
          updateStep(4, 'complete');
          showContentPreview('# Generated Content\n\nThis is where the generated content would appear...');
        }, 1500);
      }, 3000);
    }

    function showContentPreview(content) {
      document.getElementById('preview-content').innerHTML = content;
      document.getElementById('content-preview').style.display = 'block';
    }

    function updateStep(stepNum, status) {
      const step = document.querySelector(`#workflow-steps > div:nth-child(${stepNum})`);
      const circle = step.querySelector('div:first-child');
      const badge = step.querySelector('span:last-child');

      if (status === 'active') {
        circle.className = 'w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white';
        badge.className = 'px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded';
        badge.textContent = 'Active';
      } else if (status === 'complete') {
        circle.className = 'w-8 h-8 rounded-full bg-green-600 flex items-center justify-center text-white';
        circle.innerHTML = '✓';
        badge.className = 'px-2 py-1 bg-green-100 text-green-800 text-xs rounded';
        badge.textContent = 'Complete';
      }
    }

    function approveContent() {
      alert('Content approved! (In production, this would save to content/posts/)');
    }

    function requestRevision() {
      const feedback = prompt('What would you like changed?');
      if (feedback) {
        alert('Revision requested. Agent will regenerate with your feedback.');
      }
    }

    function editManually() {
      alert('Opening editor... (In production, this would open a markdown editor)');
    }
  </script>
</BaseLayout>
